@prefix : <http://www.w3id.org/agentic-ai/onto#> .
@prefix pp: <http://purl.org/net/p-plan#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix beam: <http://w3id.org/beam/core#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@base <http://www.w3id.org/agentic-ai/onto#> .
@prefix agento-ext: <http://www.w3id.org/agentic-ai/ext#> .

# Execution time: 85.09 seconds
# Model used: gpt-5-mini

# Issues / Assumptions:
# - The ontology does not provide an explicit class or property to represent execution/process type (e.g., Process.sequential). Represented as descriptive text on the WorkflowPattern.
# - The runtime behaviors (methods kickoff(), train(), arguments parsing, CLI semantics, environment variable handling, and code-level constructs) cannot be modeled directly. These are summarized in descriptions and prompts rather than as executable elements.
# - Secrets and environment variables (OPENAI_API_KEY) are present in the source; sensitive values are not modeled other than noting presence in the LanguageModel description.
# - The ontology lacks a direct way to represent tool implementation details (function signatures, library calls). These are described in the Tool's description and Prompt fields as literals.
# - The ontology lacks a property for "uses library" or "invokes API call" distinct from resource usage; tool implementation is recorded in descriptions and linked resources.
# - Training iterations and the train/run programmatic distinction are not a first-class concept in the ontology; training behavior is preserved in textual descriptions attached to the relevant Task/Team/WorkflowPattern.
#
# No other classes or properties were added or modified; all modeling uses only provided classes/properties.

#################################################################
# Instances for the Markdown Validator agent system
#################################################################

### Team (Crew)
:MarkDownValidatorCrewTeam rdf:type :Team ;
    rdfs:label "MarkDownValidatorCrew" ;
    <http://purl.org/dc/terms/title> "MarkDownValidatorCrew" ;
    rdfs:comment "Represents the crew defined in src/markdown_validator/crew.py. The crew organizes agents and tasks into a sequential process to validate markdown files." ;
    :hasAgentMember :RequirementsManagerAgent ;
    :hasWorkflowPattern :MarkdownValidationWorkflowPattern ;
    :hasSystemConfig :CrewSystemConfig ;
    :hasTeamGoal :MarkDownValidatorCrewGoal .

### Team goal (from agent/task configs)
:MarkDownValidatorCrewGoal rdf:type :Goal ;
    <http://purl.org/dc/terms/description> "Provide a detailed list of the markdown linting results. Give a summary with actionable tasks to address the validation results. Write your response as if you were handing it to a developer to fix the issues. DO NOT provide examples of how to fix the issues or recommend other tools to use." ;
    rdfs:label "Markdown validation crew goal" .

### Team system config (files and usage)
:CrewSystemConfig rdf:type :Config ;
    rdfs:label "MarkDownValidatorCrew system config" ;
    :configKey "agents_config_path" ;
    :configValue "config/agents.yaml; config/tasks.yaml" ;
    <http://purl.org/dc/terms/description> "Configuration references used by the crew: agents_config = 'config/agents.yaml' and tasks_config = 'config/tasks.yaml'. These files contain agent roles, goals, backstory and task descriptions and expected outputs." .

#################################################################
# Agent
#################################################################

:RequirementsManagerAgent rdf:type :LLMAgent ;
    rdfs:label "RequirementsManager (LLM Agent)" ;
    :agentID "Requirements_Manager" ;
    :agentRole "Requirements Manager" ;
    :hasAgentConfig :AgentsYamlConfig ;
    :hasAgentGoal :RequirementsManagerGoal ;
    :agentPrompt :RequirementsManagerAgentPrompt ;
    :agentToolUsage :markdown_validation_tool ;
    :useLanguageModel :DefaultLanguageModel ;
    rdfs:comment "An LLM-based agent configured to run a syntax review task using the markdown_validation_tool. allow_delegation=False, verbose=False (behavioral flags recorded in configuration descriptions)." .

### Agent goal and backstory (from agents.yaml)
:RequirementsManagerGoal rdf:type :Goal ;
    <http://purl.org/dc/terms/description> "Provide a detailed list of the markdown linting results. Give a summary with actionable tasks to address the validation results. Write your response as if you were handing it to a developer to fix the issues. DO NOT provide examples of how to fix the issues or recommend other tools to use." ;
    rdfs:label "Requirements Manager goal" .

:RequirementsManagerAgentPrompt rdf:type :Prompt ;
    rdfs:label "Requirements Manager agent prompt" ;
    :promptInstruction """role: Requirements Manager

goal: Provide a detailed list of the markdown linting results. 
Give a summary with actionable tasks to address the validation results. 
Write your response as if you were handing it to a developer to fix the issues. 
DO NOT provide examples of how to fix the issues or recommend other tools to use.

backstory: You are an expert business analyst and software QA specialist. 
You provide high quality, thorough, insightful, and actionable feedback via a detailed list of changes and actionable tasks.""" ;
    :promptContext "Agent backstory: expert business analyst and software QA specialist." ;
    :promptOutputIndicator "A detailed list of changes and actionable tasks for the developer; do not provide example fixes or recommend other tools." .

### Agents config file as a Config instance (preserve content)
:AgentsYamlConfig rdf:type :Config ;
    rdfs:label "agents.yaml" ;
    :configKey "file_path" ;
    :configValue "config/agents.yaml" ;
    <http://purl.org/dc/terms/description> """Contents of config/agents.yaml (preserved):
Requirements_Manager:
  role: >
    Requirements Manager
  goal: >
    Provide a detailed list of the markdown linting results. 
    Give a summary with actionable tasks to address the validation results. 
    Write your response as if you were handing it to a developer to fix the issues. 
    DO NOT provide examples of how to fix the issues or recommend other tools to use.
  backstory: >
    You are an expert business analyst and software QA specialist. 
    You provide high quality, thorough, insightful, and actionable feedback via a detailed list of changes and actionable tasks.
""" .

#################################################################
# Language Model used by the Agent
#################################################################

:DefaultLanguageModel rdf:type :LanguageModel ;
    rdfs:label "default_llm (ChatOpenAI)" ;
    <http://purl.org/dc/terms/description> """Instantiated in src/markdown_validator/main.py:
- Provider: ChatOpenAI (langchain_openai)
- openai_api_base: environment var OPENAI_API_BASE_URL (default: https://api.openai.com/v1)
- openai_api_key: provided via environment variable OPENAI_API_KEY (sensitive, not included here)
- temperature: 0.1
- model_name: environment var MODEL_NAME (default: gpt-4o-mini)
- top_p: 0.3

This LanguageModel instance represents the statistical model used by the LLMAgent to generate responses and to orchestrate tool use.""" .

#################################################################
# Tool and its configuration and implementation description
#################################################################

:markdown_validation_tool rdf:type :Tool ;
    rdfs:label "markdown_validation_tool" ;
    rdfs:comment "A tool exposed to the RequirementsManagerAgent. It validates markdown syntax by scanning files and returning a formatted string summarizing issues." ;
    <http://purl.org/dc/terms/description> """Tool definition (from src/markdown_validator/tools/markdownTools.py):
- Tool name registered as 'markdown_validation_tool'
- Signature (conceptual): input: file_path (string) -> output: validation_results (string)
- Behavior:
    * Checks whether file_path exists on filesystem; returns error string if not found.
    * Calls PyMarkdownApi().scan_path(file_path.strip()) to perform the markdown scan.
    * Uses format_scan_result to transform the scan result to a formatted string.
    * On PyMarkdownApiException returns 'API Exception: <exception message>'.
- Output format:
    * If no failures: 'No markdown validation issues found.'
    * If failures: one line per failure with: File, Line, Rule, Rule name, Rule description
- Constraints and usage note:
    * The tool expects only the path (filename) as input.
    * The task instructs the agent to pass only the filename to this tool.
""" ;
    :hasToolConfig :MarkdownToolConfig ;
    :resourceUsage :PyMarkdownApiLibraryInstance .

:MarkdownToolConfig rdf:type :Config ;
    rdfs:label "markdown_validation_tool config" ;
    :configKey "tool_registration_name" ;
    :configValue "markdown_validation_tool" ;
    <http://purl.org/dc/terms/description> "Configuration note: tool is registered with langchain.tools.tool decorator as 'markdown_validation_tool'. Implementation uses PyMarkdownApi from pymarkdown.api." .

:PyMarkdownApiLibraryInstance rdf:type beam:Instance ;
    rdfs:label "PyMarkdownApi" ;
    <http://purl.org/dc/terms/description> "The PyMarkdownApi library instance invoked by the tool implementation. The tool calls PyMarkdownApi().scan_path(file_path) to perform the scan and returns a formatted summary." .

#################################################################
# Task and Task-level prompts/config
#################################################################

:syntax_review_task rdf:type :Task ;
    rdfs:label "syntax_review_task" ;
    <http://purl.org/dc/terms/description> """Use the markdown_validation_tool to review the file(s) at this path: {filename}.
Be sure to pass only the file path to the markdown_validation_tool.
Use the following format to call the markdown_validation_tool:
Do I need to use a tool? Yes
Action: markdown_validation_tool
Action Input: {filename}

Get the validation results from the tool and then summarize it into a list of changes
the developer should make to the document.
DO NOT recommend ways to update the document.
DO NOT change any of the content of the document or add content to it. 
It is critical to your task to only respond with a list of changes.

If you already know the answer or if you do not need to use a tool, 
return it as your Final Answer.
""" ;
    :performedByAgent :RequirementsManagerAgent ;
    :hasConfig :TasksYamlConfig ;
    :taskPrompt :SyntaxReviewTaskPrompt ;
    :requiresResource :InputMarkdownFile ;
    :producedResource :ValidationReportResource ;
    rdfs:comment "This task is the primary action that the crew executes. It requires that the agent call markdown_validation_tool with the provided filename, then summarize results into a list of changes for the developer." .

:TasksYamlConfig rdf:type :Config ;
    rdfs:label "tasks.yaml" ;
    :configKey "file_path" ;
    :configValue "config/tasks.yaml" ;
    <http://purl.org/dc/terms/description> """Contents of config/tasks.yaml (preserved):
syntax_review_task:
  description: >
    Use the markdown_validation_tool to review the file(s) at this path: {filename}.
    Be sure to pass only the file path to the markdown_validation_tool.
    Use the following format to call the markdown_validation_tool:
    Do I need to use a tool? Yes
    Action: markdown_validation_tool
    Action Input: {filename}

    Get the validation results from the tool and then summarize it into a list of changes
    the developer should make to the document.
    DO NOT recommend ways to update the document.
    DO NOT change any of the content of the document or add content to it. 
    It is critical to your task to only respond with a list of changes.

    If you already know the answer or if you do not need to use a tool, 
    return it as your Final Answer.
  expected_output: >
    A list of changes the developer should make to the document based on the markdown validation results.
""" .

:SyntaxReviewTaskPrompt rdf:type :Prompt ;
    rdfs:label "syntax_review_task prompt" ;
    :promptInstruction """Use the markdown_validation_tool to review the file(s) at this path: {filename}.
Be sure to pass only the file path to the markdown_validation_tool.
Use the following format to call the markdown_validation_tool:
Do I need to use a tool? Yes
Action: markdown_validation_tool
Action Input: {filename}

Get the validation results from the tool and then summarize it into a list of changes
the developer should make to the document.
DO NOT recommend ways to update the document.
DO NOT change any of the content of the document or add content to it.
It is critical to your task to only respond with a list of changes.

If you already know the answer or if you do not need to use a tool,
return it as your Final Answer.
""" ;
    :promptInputData "{filename}" ;
    :promptOutputIndicator "A list of changes the developer should make to the document based on the markdown validation results." .

#################################################################
# Data artifacts: input file and produced validation report
#################################################################

:InputMarkdownFile rdf:type beam:Instance ;
    rdfs:label "Input markdown file (CLI filename)" ;
    <http://purl.org/dc/terms/description> "The file path provided via command-line to the CLI (sys.argv[1] when running). The task expects only the file path string (filename) to be passed to the markdown_validation_tool." .

:ValidationReportResource rdf:type beam:Resource ;
    rdfs:label "Markdown validation report (tool output)" ;
    <http://purl.org/dc/terms/description> "Formatted string of validation results returned by markdown_validation_tool. Example output forms: 'No markdown validation issues found.' or a newline-separated list of detected rule violations with file, line, rule id, rule name and description." .

#################################################################
# Workflow pattern and steps (sequential)
#################################################################

:MarkdownValidationWorkflowPattern rdf:type :WorkflowPattern ;
    rdfs:label "Markdown Validation Workflow (sequential)" ;
    <http://purl.org/dc/terms/description> "Workflow pattern representing the crew's sequential process. Process in implementation: Process.sequential (the crew's Process enumeration is recorded here as descriptive text)." ;
    :hasWorkflowStep :StartSyntaxReviewStep , :EndStepAfterReview .

:StartSyntaxReviewStep rdf:type :StartStep ;
    rdfs:label "Start: Syntax Review Step" ;
    :hasAssociatedTask :syntax_review_task ;
    :stepOrder 1 ;
    <http://purl.org/dc/terms/description> "Initial workflow step that triggers the syntax_review_task using the RequirementsManager agent with the provided filename input." ;
    :nextStep :EndStepAfterReview .

:EndStepAfterReview rdf:type :EndStep ;
    rdfs:label "End: After Review" ;
    :stepOrder 2 ;
    <http://purl.org/dc/terms/description> "Final step indicating completion of the syntax review and that the ValidationReportResource has been produced and returned to the caller." .

#################################################################
# Execution notes and connections
#################################################################

### Agent uses the tool to perform the task
:RequirementsManagerAgent :agentToolUsage :markdown_validation_tool .

### Task is performed by the agent and the produced resource is the validation output
:syntax_review_task :performedByAgent :RequirementsManagerAgent ;
    :producedResource :ValidationReportResource .

### Tool accesses the input file resource (resourceUsage) and uses PyMarkdownApi internally
:markdown_validation_tool :resourceUsage :InputMarkdownFile ;
    rdfs:comment "The tool reads the file path provided and performs file existence check before invoking the PyMarkdownApi scan." .

#################################################################
# Additional descriptive metadata (preserve important run/train semantics)
#################################################################

:RunScript rdf:type :Context ;
    rdfs:label "main.py run/train description" ;
    <http://purl.org/dc/terms/description> """Behavior described in src/markdown_validator/main.py:
- run(): expects filename at sys.argv[1]; constructs inputs map with 'query' and 'filename'; if filename provided, calls MarkDownValidatorCrew().crew().kickoff(inputs=inputs) and returns or prints resulting validation report. If no filename provided, raises ValueError.
- train(): expects number of iterations at sys.argv[1] and filename at sys.argv[2]; constructs inputs map and calls MarkDownValidatorCrew().crew().train(n_iterations=int(sys.argv[1]), filename=inputs['filename']). Errors are raised when missing inputs or exceptions during training.
- Environment variables used to configure the LLM: OPENAI_API_KEY, OPENAI_API_BASE_URL, MODEL_NAME. These are managed via dotenv.load_dotenv.
Note: The exact procedural behavior (kickoff, train) belongs to the framework (crewai) and is preserved here as descriptive text attached to this Context instance.
""" .

#################################################################
# End of instance data
#################################################################

################################################################################
# KickoffInputBundle (agento-ext) â€” Uniform runtime inputs for pipeline extraction
################################################################################

:KickoffInput_filename a agento-ext:KickoffInputBundle ;
    agento-ext:inputKey "filename" ;
    agento-ext:inputValue "" ;
    agento-ext:isDefaultValue false .
