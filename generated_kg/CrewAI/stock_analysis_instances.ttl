# Execution time: 113.06 seconds
# Model used: gpt-5-mini

# Issues / Assumptions:
# - The source code contains two definitions named `financial_analysis` (one returns `financial_agent`, another `financial_analyst_agent`). In Python the latter definition would override the former; both were preserved as distinct semantic artifacts here to avoid losing information. Consumers should be aware of this ambiguity.
# - The ontology has no property to record the crew process type (e.g., Process.sequential). I put the workflow as an explicit WorkflowPattern and ordered steps, but cannot assert the Crew.process enumeration value because no property exists in the schema.
# - The ontology lacks a specific property to represent tool argument schemas (args_schema), runtime initialization details, or environment variables (e.g., SEC_API_API_KEY). These are captured as literal text inside Config and description fields but cannot be modeled structurally.
# - The ontology does not have explicit constructs to model code-level methods (kickoff/train), or control-flow functions. I modeled the logical workflow, tasks, prompts, and artifacts, but not the SDK/framework calls or training loop semantics.
# - The ontology does not provide a key/value pair structure for Config entries. I represented each config entry as its own :Config instance with :configKey and :configValue. This preserves fidelity but is not a structured map.
# - Implementation details such as SDK classes, Python-specific constructs, .pyc artifacts, or bytecode were intentionally omitted per instructions; configuration text, prompt content, and semantic behavior are preserved as literals.

@prefix : <http://www.w3id.org/agentic-ai/onto#> .
@prefix beam: <http://w3id.org/beam/core#> .
@prefix pp: <http://purl.org/net/p-plan#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@base <http://www.w3id.org/agentic-ai/onto#> .

#################################################################
# Team / Crew
#################################################################

:StockAnalysisCrew rdf:type :Team ;
    rdfs:label "Stock Analysis Crew" ;
    dcterms:description "Team that coordinates a set of LLM agents and tasks to perform stock/filings/research analysis for a given company ticker (example: AMZN)." ;
    :hasAgentMember :LLM_FinancialAgent_1 , :LLM_FinancialAnalystAgent , :LLM_ResearchAnalystAgent , :LLM_InvestmentAdvisorAgent ;
    :hasWorkflowPattern :StockAnalysisWorkflow ;
    :hasSystemConfig :Config_Crew_AgentsFile , :Config_Crew_TasksFile ;
    :hasTeamGoal :Goal_StockAnalysis .

:Config_Crew_AgentsFile rdf:type :Config ;
    :configKey "file" ;
    :configValue "config/agents.yaml" ;
    dcterms:description "Path to agents configuration file used by the crew (source: src/stock_analysis/config/agents.yaml)." .

:Config_Crew_TasksFile rdf:type :Config ;
    :configKey "file" ;
    :configValue "config/tasks.yaml" ;
    dcterms:description "Path to tasks configuration file used by the crew (source: src/stock_analysis/config/tasks.yaml)." .

:Goal_StockAnalysis rdf:type :Goal ;
    dcterms:description "Conduct stock and filings analysis pipeline that collects news, analyzes EDGAR filings, computes key financial metrics and produces investment recommendations." ;
    rdfs:label "Stock analysis overall goal" .

#################################################################
# Language Model
#################################################################

:LM_Ollama_llama3_1 rdf:type :LanguageModel ;
    rdfs:label "Ollama (llama3.1)" ;
    dcterms:description "Language model endpoint used by the agents via LangChain Ollama(model='llama3.1')." .

#################################################################
# Capabilities
#################################################################

:Capability_ScrapeWebsite rdf:type :Capability ;
    rdfs:label "web scraping" ;
    dcterms:description "Capability to fetch and extract textual content from web pages." .

:Capability_WebsiteSearch rdf:type :Capability ;
    rdfs:label "website search" ;
    dcterms:description "Capability to search web content and return links or content snippets (site-level search)." .

:Capability_Calculation rdf:type :Capability ;
    rdfs:label "mathematical calculation" ;
    dcterms:description "Numeric computation capability (safe evaluation of arithmetic expressions)." .

:Capability_SEC10K_Search rdf:type :Capability ;
    rdfs:label "SEC 10-K semantic search" ;
    dcterms:description "Semantic search over the latest 10-K filing content for a specified company ticker." .

:Capability_SEC10Q_Search rdf:type :Capability ;
    rdfs:label "SEC 10-Q semantic search" ;
    dcterms:description "Semantic search over the latest 10-Q filing content for a specified company ticker." .

#################################################################
# Tools (Tool instances and configurations)
#################################################################

:Tool_Calculator rdf:type :Tool ;
    rdfs:label "CalculatorTool" ;
    dcterms:description """
    Calculator tool (from src/stock_analysis/tools/calculator_tool.py).
    Purpose: perform mathematical calculations expressed as arithmetic expressions (examples: '200*7', '5000/2*10').
    Implementation notes summarized: safe AST evaluation allowing operators + - * / ** % and unary +/-. Filters allowed characters using regex '^[0-9+\\-*/().% ]+$'. Raises ValueError on invalid input or errors (syntax, division by zero, unsupported nodes).
    """.

:Tool_ScrapeWebsite rdf:type :Tool ;
    rdfs:label "ScrapeWebsiteTool" ;
    dcterms:description "Tool used to fetch and convert HTML pages into text for downstream processing. Referenced from crewai_tools usage in the crew." .

:Tool_WebsiteSearch rdf:type :Tool ;
    rdfs:label "WebsiteSearchTool" ;
    dcterms:description "Tool used for general website search (referenced from crewai_tools in the crew)." .

:Tool_TXTSearch rdf:type :Tool ;
    rdfs:label "TXTSearchTool" ;
    dcterms:description "Tool used for searching plaintext resources (referenced from crewai_tools in the crew)." .

:SEC10KTool_Generic rdf:type :Tool ;
    rdfs:label "SEC10KTool (generic)" ;
    dcterms:description """
    A RAG-style tool for semantic search in 10-K filings (class src/stock_analysis/tools/sec_tools.py).
    Default args_schema: requires search_query and stock_name.
    Behavior: when initialized with a specific stock_name, it fetches the most recent 10-K filing via the SEC API (sec_api.QueryApi using environment variable SEC_API_API_KEY), requests the filing details URL, converts HTML to text using html2text, cleans non-alphanumeric characters with regex r'[^a-zA-Z$0-9\\s\\n]' and adds resulting text to its internal RAG index (DataType.TEXT).
    """.

:SEC10KTool_AMZN rdf:type :Tool ;
    rdfs:label "SEC10KTool(AMZN)" ;
    dcterms:description """
    Instance of SEC10KTool initialized with stock_name='AMZN'. On init it attempted to fetch AMZN's latest 10-K, converted it to text, cleaned non-alphanumeric characters, and added the text to its internal index. Its args_schema becomes FixedSEC10KToolSchema (only search_query required subsequently).
    """;
    :hasToolConfig :Config_SEC10K_AMZN_stock ;
    :resourceUsage :AMZN_10K_KB ;
    :hasCapability :Capability_SEC10K_Search .

:Config_SEC10K_AMZN_stock rdf:type :Config ;
    :configKey "stock_name" ;
    :configValue "AMZN" ;
    dcterms:description "Configuration indicating this SEC10K tool instance was created for AMZN and preloaded with its latest 10-K content if available." .

:SEC10QTool_Generic rdf:type :Tool ;
    rdfs:label "SEC10QTool (generic)" ;
    dcterms:description """
    A RAG-style tool for semantic search in 10-Q filings (class src/stock_analysis/tools/sec_tools.py).
    Default args_schema: requires search_query and stock_name.
    Behavior: when initialized with a specific stock_name, it fetches the most recent 10-Q filing via the SEC API, converts HTML to text using html2text, cleans non-alphanumeric characters with regex r'[^a-zA-Z$0-9\\s\\n]' and adds resulting text to its internal index (DataType.TEXT).
    """.

:SEC10QTool_AMZN rdf:type :Tool ;
    rdfs:label "SEC10QTool(AMZN)" ;
    dcterms:description """
    Instance of SEC10QTool initialized with stock_name='AMZN'. On init it attempted to fetch AMZN's latest 10-Q, converted it to text, cleaned non-alphanumeric characters, and added the text to its internal index. Its args_schema becomes FixedSEC10QToolSchema (only search_query required subsequently).
    """;
    :hasToolConfig :Config_SEC10Q_AMZN_stock ;
    :resourceUsage :AMZN_10Q_KB ;
    :hasCapability :Capability_SEC10Q_Search .

:Config_SEC10Q_AMZN_stock rdf:type :Config ;
    :configKey "stock_name" ;
    :configValue "AMZN" ;
    dcterms:description "Configuration indicating this SEC10Q tool instance was created for AMZN and preloaded with its latest 10-Q content if available." .

#################################################################
# Resources / KnowledgeBases produced or used by tools
#################################################################

:AMZN_10K_KB rdf:type :KnowledgeBase ;
    rdfs:label "AMZN latest 10-K (text content, processed)" ;
    dcterms:description """
    Textual content extracted from AMZN's latest 10-K filing (if successfully fetched). Preprocessing: converted from HTML via html2text, then non-alphanumeric characters stripped using regex r'[^a-zA-Z$0-9\\s\\n]'.
    Stored as DataType.TEXT inside the RAG tool index (embedchain).
    """ ;
    rdfs:comment "Represents the resource created/added by SEC10KTool(AMZN)." .

:AMZN_10Q_KB rdf:type :KnowledgeBase ;
    rdfs:label "AMZN latest 10-Q (text content, processed)" ;
    dcterms:description """
    Textual content extracted from AMZN's latest 10-Q filing (if successfully fetched). Preprocessing: converted from HTML via html2text, then non-alphanumeric characters stripped using regex r'[^a-zA-Z$0-9\\s\\n]'.
    Stored as DataType.TEXT inside the RAG tool index (embedchain).
    """ ;
    rdfs:comment "Represents the resource created/added by SEC10QTool(AMZN)." .

:News_Summary_Resource rdf:type beam:Resource ;
    rdfs:label "News summary resource" ;
    dcterms:description "Resource representing aggregated news, press releases and market analysis text collected by the Research task using web search and scraping tools." .

#################################################################
# Agents (LLMAgent instances)
#################################################################

:LLM_FinancialAgent_1 rdf:type :LLMAgent ;
    rdfs:label "financial_agent (method: financial_agent)" ;
    :agentID "financial_agent" ;
    :agentRole "The Best Financial Analyst" ;
    dcterms:description "Agent configured using agents.yaml entry 'financial_analyst'. Contains tools for scraping, website search, math calcs, and SEC filing search for AMZN; intended to perform financial analysis tasks." ;
    :agentPrompt :Prompt_FinancialAgent_System ;
    :hasAgentConfig :Config_FA_role , :Config_FA_goal , :Config_FA_backstory ;
    :agentToolUsage :Tool_ScrapeWebsite , :Tool_WebsiteSearch , :Tool_Calculator , :SEC10QTool_AMZN , :SEC10KTool_AMZN ;
    :hasAgentCapability :Capability_ScrapeWebsite , :Capability_WebsiteSearch , :Capability_Calculation , :Capability_SEC10Q_Search , :Capability_SEC10K_Search ;
    :useLanguageModel :LM_Ollama_llama3_1 .

:LLM_FinancialAnalystAgent rdf:type :LLMAgent ;
    rdfs:label "financial_analyst_agent (method: financial_analyst_agent)" ;
    :agentID "financial_analyst_agent" ;
    :agentRole "The Best Financial Analyst" ;
    dcterms:description "Second agent factory in code with same configuration name 'financial_analyst'. Similar toolset but some tool instantiations use no explicit stock_name (generic SEC tools)." ;
    :agentPrompt :Prompt_FinancialAnalystAgent_System ;
    :hasAgentConfig :Config_FA_role , :Config_FA_goal , :Config_FA_backstory ;
    :agentToolUsage :Tool_ScrapeWebsite , :Tool_WebsiteSearch , :Tool_Calculator , :SEC10QTool_Generic , :SEC10KTool_Generic ;
    :hasAgentCapability :Capability_ScrapeWebsite , :Capability_WebsiteSearch , :Capability_Calculation , :Capability_SEC10Q_Search , :Capability_SEC10K_Search ;
    :useLanguageModel :LM_Ollama_llama3_1 .

:LLM_ResearchAnalystAgent rdf:type :LLMAgent ;
    rdfs:label "research_analyst_agent" ;
    :agentID "research_analyst_agent" ;
    :agentRole "Staff Research Analyst" ;
    dcterms:description "Agent configured using agents.yaml entry 'research_analyst'. Tools: scraping, and SEC filings (10-Q, 10-K for AMZN). WebsiteSearch tool is commented out in the code, so not included here." ;
    :agentPrompt :Prompt_ResearchAnalyst_System ;
    :hasAgentConfig :Config_RA_role , :Config_RA_goal , :Config_RA_backstory ;
    :agentToolUsage :Tool_ScrapeWebsite , :SEC10QTool_AMZN , :SEC10KTool_AMZN ;
    :hasAgentCapability :Capability_ScrapeWebsite , :Capability_SEC10Q_Search , :Capability_SEC10K_Search ;
    :useLanguageModel :LM_Ollama_llama3_1 .

:LLM_InvestmentAdvisorAgent rdf:type :LLMAgent ;
    rdfs:label "investment_advisor_agent" ;
    :agentID "investment_advisor_agent" ;
    :agentRole "Private Investment Advisor" ;
    dcterms:description "Agent configured using agents.yaml entry 'investment_advisor'. Tools: scraping, website search, calculator. Responsible for synthesizing analyses into a recommendation." ;
    :agentPrompt :Prompt_InvestmentAdvisor_System ;
    :hasAgentConfig :Config_IA_role , :Config_IA_goal , :Config_IA_backstory ;
    :agentToolUsage :Tool_ScrapeWebsite , :Tool_WebsiteSearch , :Tool_Calculator ;
    :hasAgentCapability :Capability_ScrapeWebsite , :Capability_WebsiteSearch , :Capability_Calculation ;
    :useLanguageModel :LM_Ollama_llama3_1 .

#################################################################
# Agent configuration entries (preserve YAML fields as Config individuals)
#################################################################

:Config_FA_role rdf:type :Config ;
    :configKey "role" ;
    :configValue "The Best Financial Analyst" ;
    dcterms:description "agents.yaml: financial_analyst.role" .

:Config_FA_goal rdf:type :Config ;
    :configKey "goal" ;
    :configValue "Impress all customers with your financial data and market trends analysis" ;
    dcterms:description "agents.yaml: financial_analyst.goal" .

:Config_FA_backstory rdf:type :Config ;
    :configKey "backstory" ;
    :configValue "The most seasoned financial analyst with lots of expertise in stock market analysis and investment strategies that is working for a super important customer." ;
    dcterms:description "agents.yaml: financial_analyst.backstory" .

:Config_RA_role rdf:type :Config ;
    :configKey "role" ;
    :configValue "Staff Research Analyst" ;
    dcterms:description "agents.yaml: research_analyst.role" .

:Config_RA_goal rdf:type :Config ;
    :configKey "goal" ;
    :configValue "Being the best at gathering, interpreting data and amazing your customer with it" ;
    dcterms:description "agents.yaml: research_analyst.goal" .

:Config_RA_backstory rdf:type :Config ;
    :configKey "backstory" ;
    :configValue "Known as the BEST research analyst, you're skilled in sifting through news, company announcements, and market sentiments. Now you're working on a super important customer." ;
    dcterms:description "agents.yaml: research_analyst.backstory" .

:Config_IA_role rdf:type :Config ;
    :configKey "role" ;
    :configValue "Private Investment Advisor" ;
    dcterms:description "agents.yaml: investment_advisor.role" .

:Config_IA_goal rdf:type :Config ;
    :configKey "goal" ;
    :configValue "Impress your customers with full analyses over stocks and complete investment recommendations" ;
    dcterms:description "agents.yaml: investment_advisor.goal" .

:Config_IA_backstory rdf:type :Config ;
    :configKey "backstory" ;
    :configValue "You're the most experienced investment advisor and you combine various analytical insights to formulate strategic investment advice. You are now working for a super important customer you need to impress." ;
    dcterms:description "agents.yaml: investment_advisor.backstory" .

#################################################################
# Prompts (system prompts for agents and task prompts)
#################################################################

:Prompt_FinancialAgent_System rdf:type :Prompt ;
    rdfs:label "Financial Agent system prompt" ;
    :promptInstruction "Role: The Best Financial Analyst\nGoal: Impress all customers with your financial data and market trends analysis\nBackstory: The most seasoned financial analyst with lots of expertise in stock market analysis and investment strategies that is working for a super important customer." ;
    :promptContext "This prompt is used as the agent/system instruction for the financial agent to guide independent behaviour." .

:Prompt_FinancialAnalystAgent_System rdf:type :Prompt ;
    rdfs:label "Financial Analyst Agent (duplicate) system prompt" ;
    :promptInstruction "Role: The Best Financial Analyst\nGoal: Impress all customers with your financial data and market trends analysis\nBackstory: The most seasoned financial analyst with lots of expertise in stock market analysis and investment strategies that is working for a super important customer." ;
    :promptContext "This prompt is produced from the second factory for financial_analyst_agent in the code (duplicate configuration)." .

:Prompt_ResearchAnalyst_System rdf:type :Prompt ;
    rdfs:label "Research Analyst system prompt" ;
    :promptInstruction "Role: Staff Research Analyst\nGoal: Being the best at gathering, interpreting data and amazing your customer with it\nBackstory: Known as the BEST research analyst, you're skilled in sifting through news, company announcements, and market sentiments. Now you're working on a super important customer." ;
    :promptContext "System prompt for the research analyst agent." .

:Prompt_InvestmentAdvisor_System rdf:type :Prompt ;
    rdfs:label "Investment Advisor system prompt" ;
    :promptInstruction "Role: Private Investment Advisor\nGoal: Impress your customers with full analyses over stocks and complete investment recommendations\nBackstory: You're the most experienced investment advisor and you combine various analytical insights to formulate strategic investment advice. You are now working for a super important customer you need to impress." ;
    :promptContext "System prompt for the investment advisor agent." .

#################################################################
# Tasks and Task Prompts (from config/tasks.yaml)
#################################################################

:Task_financial_analysis rdf:type :Task ;
    rdfs:label "financial_analysis" ;
    dcterms:description """
    Conduct a thorough analysis of {company_stock}'s stock financial health and market performance. This includes examining key financial metrics such as P/E ratio, EPS growth, revenue trends, and debt-to-equity ratio. Also, analyze the stock's performance in comparison to its industry peers and overall market trends.
    """ ;
    :taskPrompt :Prompt_Task_FinancialAnalysis ;
    :performedByAgent :LLM_FinancialAnalystAgent ;
    :producedResource :FinancialAnalysis_ReportResource .

:Prompt_Task_FinancialAnalysis rdf:type :Prompt ;
    rdfs:label "Task prompt: financial_analysis" ;
    :promptInstruction "Conduct a thorough analysis of {company_stock}'s stock financial health and market performance. Examine P/E ratio, EPS growth, revenue trends, debt-to-equity, comparisons to peers and market trends." ;
    :promptOutputIndicator "Final report must include assessment, strengths and weaknesses, comparison to competitors, and use most recent data possible." ;
    :promptContext "Inputs include placeholders: {company_stock} and 'query' (user prompt)." .

:FinancialAnalysis_ReportResource rdf:type beam:Resource ;
    rdfs:label "Financial analysis report resource" ;
    dcterms:description "Resource representing the final financial analysis report produced by financial_analysis task. Expected to include metrics and narrative assessment." .

:Task_research rdf:type :Task ;
    rdfs:label "research" ;
    dcterms:description """
    Collect and summarize recent news articles, press releases, and market analyses related to the {company_stock} stock and its industry. Pay special attention to any significant events, market sentiments, and analysts' opinions. Also include upcoming events like earnings and others.
    """ ;
    :taskPrompt :Prompt_Task_Research ;
    :performedByAgent :LLM_ResearchAnalystAgent ;
    :producedResource :News_Summary_Resource .

:Prompt_Task_Research rdf:type :Prompt ;
    rdfs:label "Task prompt: research" ;
    :promptInstruction "Collect and summarize recent news articles, press releases, and market analyses related to {company_stock}. Focus on significant events, market sentiment, analysts' opinions, upcoming events such as earnings." ;
    :promptOutputIndicator "Return a comprehensive summary and return the stock ticker as {company_stock}." ;
    :promptContext "Inputs include placeholders: {company_stock}." .

:Task_filings_analysis rdf:type :Task ;
    rdfs:label "filings_analysis" ;
    dcterms:description """
    Analyze the latest 10-Q and 10-K filings from EDGAR for the stock {company_stock} in question. Focus on key sections like Management's Discussion and analysis, financial statements, insider trading activity, and any disclosed risks. Extract relevant data and insights that could influence the stock's future performance.
    """ ;
    :taskPrompt :Prompt_Task_FilingsAnalysis ;
    :performedByAgent :LLM_FinancialAnalystAgent ;
    :requiresResource :AMZN_10K_KB , :AMZN_10Q_KB ;
    :producedResource :Filings_Analysis_ReportResource .

:Prompt_Task_FilingsAnalysis rdf:type :Prompt ;
    rdfs:label "Task prompt: filings_analysis" ;
    :promptInstruction "Analyze the latest 10-Q and 10-K filings for {company_stock}. Focus on MD&A, financial statements, insider trading, and disclosed risks. Extract insights that influence future performance." ;
    :promptOutputIndicator "Final answer should highlight significant findings, red flags or positive indicators from filings." ;
    :promptContext "This prompt expects the agent to use SEC10K/SEC10Q tools (RAG) to query filings content." .

:Filings_Analysis_ReportResource rdf:type beam:Resource ;
    rdfs:label "Filings analysis report resource" ;
    dcterms:description "Report summarizing important findings from EDGAR filings (10-K, 10-Q) including flagged items and extracted metrics." .

:Task_recommend rdf:type :Task ;
    rdfs:label "recommend" ;
    dcterms:description """
    Review and synthesize the analyses provided by the Financial Analyst and the Research Analyst. Combine these insights to form a comprehensive investment recommendation. MUST consider financial health, market sentiment, and qualitative data from EDGAR filings. Include insider trading activity and upcoming events like earnings.
    """ ;
    :taskPrompt :Prompt_Task_Recommend ;
    :performedByAgent :LLM_InvestmentAdvisorAgent ;
    :requiresResource :FinancialAnalysis_ReportResource , :News_Summary_Resource , :Filings_Analysis_ReportResource ;
    :producedResource :Investment_Recommendation_ReportResource .

:Prompt_Task_Recommend rdf:type :Prompt ;
    rdfs:label "Task prompt: recommend" ;
    :promptInstruction "Synthesize Financial Analyst and Research Analyst outputs and produce a full detailed investment recommendation. Consider financial health, market sentiment, filings data, insider trading, and upcoming events." ;
    :promptOutputIndicator "Final answer MUST be a recommendation: a full super detailed report, clear investment stance and strategy with supporting evidence, well formatted for the customer." ;
    :promptContext "Inputs include outputs from other tasks and primary placeholders {company_stock}." .

:Investment_Recommendation_ReportResource rdf:type beam:Resource ;
    rdfs:label "Investment recommendation report" ;
    dcterms:description "Final recommendation report produced by recommend task, combining financial, news and filings analyses." .

#################################################################
# Mapping tasks into a WorkflowPattern (sequential logical flow)
#################################################################

:StockAnalysisWorkflow rdf:type :WorkflowPattern ;
    rdfs:label "Stock Analysis Sequential Workflow" ;
    dcterms:description "Workflow pattern representing the crew's intended sequential pipeline: research -> filings_analysis -> financial_analysis -> recommend" ;
    :hasWorkflowStep :Step_1_Research , :Step_2_FilingsAnalysis , :Step_3_FinancialAnalysis , :Step_4_Recommend .

:Step_1_Research rdf:type :StartStep ;
    rdfs:label "Step 1 - Research" ;
    :hasAssociatedTask :Task_research ;
    :stepOrder 1 .

:Step_2_FilingsAnalysis rdf:type :WorkflowStep ;
    rdfs:label "Step 2 - Filings analysis" ;
    :hasAssociatedTask :Task_filings_analysis ;
    :stepOrder 2 .

:Step_3_FinancialAnalysis rdf:type :WorkflowStep ;
    rdfs:label "Step 3 - Financial analysis" ;
    :hasAssociatedTask :Task_financial_analysis ;
    :stepOrder 3 .

:Step_4_Recommend rdf:type :EndStep ;
    rdfs:label "Step 4 - Recommend" ;
    :hasAssociatedTask :Task_recommend ;
    :stepOrder 4 .

# Sequential links between steps
:Step_1_Research :nextStep :Step_2_FilingsAnalysis .
:Step_2_FilingsAnalysis :nextStep :Step_3_FinancialAnalysis .
:Step_3_FinancialAnalysis :nextStep :Step_4_Recommend .

#################################################################
# Task-to-tool and resource relationships (how tasks use tools/resources)
#################################################################

# Research task uses scraping and website search tools
:Task_research :requiresResource :News_Summary_Resource .
:Task_research :performedBy :Tool_ScrapeWebsite .  # semantically: the task uses the tool to perform work (best available mapping)
:Task_research :requiresResource :AMZN_10Q_KB .

# Filings analysis task relies on SEC RAG tools and their KBs
:Task_filings_analysis :performedBy :SEC10KTool_AMZN , :SEC10QTool_AMZN .
:Task_filings_analysis :requiresResource :AMZN_10K_KB , :AMZN_10Q_KB .

# Financial analysis task uses calculator and other tools for numeric metrics
:Task_financial_analysis :performedBy :Tool_Calculator , :Tool_ScrapeWebsite , :Tool_WebsiteSearch .
:Task_financial_analysis :requiresResource :FinancialAnalysis_ReportResource .

# Recommend task synthesizes prior outputs
:Task_recommend :performedBy :Tool_Calculator , :Tool_WebsiteSearch .

#################################################################
# Miscellaneous mapping and notes preserved
#################################################################

# The crew's main entry 'run' uses inputs: query and company_stock (example: AMZN)
:Input_Query rdf:type :Context ;
    rdfs:label "input:query" ;
    dcterms:description "User input prompt example: 'What is the company you want to analyze?'" .

:Input_CompanyStock rdf:type :Context ;
    rdfs:label "input:company_stock" ;
    dcterms:description "Input placeholder for the stock ticker to analyze (example: 'AMZN')." .

#################################################################
# End of instance population
#################################################################